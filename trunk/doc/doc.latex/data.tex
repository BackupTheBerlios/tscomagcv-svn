%
% data.tex
% Copyright (c) Markus Kohm, 2009
%
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; version 2 of the License.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
%

\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[english]{babel}
\usepackage{alltt}
\usepackage{xspace}
\ifx \HCode\UnDef
\usepackage{booktabs}
\fi
\providecommand*\toprule{\hline}
\providecommand*\midrule{\hline}
\providecommand*\bottomrule{\hline}
\usepackage{tabularx}
\usepackage{amsmath}
\usepackage{svn}\SVN $Id$
\ifx \HCode\UnDef
\usepackage{hyperref}
\else
\usepackage[tex4ht]{hyperref}
\fi
\usepackage[table,cmyk,svgnames]{xcolor}
\usepackage{babelbib}
\bibliographystyle{babalpha-fl}

\hypersetup{%
  pdftitle={Data Formats of the Comag PVR2/100CI},
  pdfauthor={Markus Kohm},
  pdfkeywords={meta.dat,rec.cp,rec.bm,rec.ts,Comag PVR2/100CI,%
    Silvercrest SL80/2 100CI, Boca PVR2 100CI, Digital M100/2CI},
}

\colorlet{unsure}{DarkRed}
\colorlet{unknown}{Red}

\newcommand*{\Comag}{Comag PVR2/100CI\xspace}
\newcommand*{\Silvercrest}{Silvercrest SL80/2 100CI\xspace}
\newcommand*{\Boca}{Boca PVR2/100CI\xspace}
\newcommand*{\Digital}{Digital M100/2CI\xspace}

\begin{document}
\pdfbookmark[1]{\Comag}{title}
\title{Data Formats of the \Comag\footnote{aka
    \Silvercrest aka \Boca aka \Digital}\,\footnote{This is: ``\SVNId''.}}
\subtitle{Draft}
\author{Markus Kohm}
\SVNdate $Date$
\maketitle
\begin{abstract}
  The sat receiver \Comag has an internal HDD and may record to this and play
  from it. It can also handle external storage devices via USB. Recordings are
  managed to special named directories with three management files
  \texttt{meta.dat}, \texttt{rec.cp}, \texttt{rec.bm} and several MPEG
  transport stream files, names \texttt{rec.ts}, \texttt{rec.01},
  \texttt{rec.02} \dots\@\ Only special TS files can be used by the receiver.
\end{abstract}

\pdfbookmark[1]{\contentsname}{toc}
\tableofcontents

\section{The HDD-Organization}
\label{sec:hdd-organization}

The \Comag reads only the first VFAT partition of the HDD or storage
device. This partition type should be FAT32~LBA (0xC) and the filesystem has
to be VFAT. Nevertheless the \Comag does not show long filenames but trunks
all filenames to eight characters.

Records should be done to the root directory and are organized in directories
named \texttt{rec\_\textit{DDDD}} where \texttt{\textit{DDDD}} is a four digit
decimal number. We call these directories \emph{Records}. See
\autoref{sec:records} for more information about.

Note: Sometimes external USB storages may not be recognized. Sometimes it
helps to unplug an replug the USB cable.

\section{The \texttt{rec\_\textit{DDDD}} Directories}
\label{sec:records}

A \emph{Record} is a directory named \texttt{rec\_\textit{XXXX}} with
\texttt{\textit{DDDD}} is a four digit decimal number. Only files at
directories with this naming scheme are recognized by the \Comag to be
playable.

Each Record contains three management files and one or more files with the
transport stream. The management files are:
\begin{labeling}[:]{\texttt{meta.dat}}
\item [\texttt{meta.dat}] This information will be shown in the display and
  the overview but not in the info box or while cutting. It is
  essential. Without this information the record does not work. See
  \autoref{sec:meta.dat-file} for more information about.
\item [\texttt{rec.bm}] This information may be regenerated by the \Comag, if
  it is not there. See \autoref{sec:rec.bm-file} for more information about.
\item [\texttt{rec.cp}] This information may be regenerated by the \Comag, if
  it is not there. See \autoref{sec:rec.cp-file} for more information about.
\end{labeling}

The transport stream is saved at files \texttt{rec.ts}, \texttt{rec.01},
\texttt{rec.02} \dots\@\ Each with a maximum file size of 2.0\,GB\footnote{The
  exact maximum file size seems to be $2\,147\,471\,360\,\textrm{bytes} =
  11\,422\,720 \cdot 188\,\textrm{bytes}$. And the first file, \texttt{rec.ts}
  seems to be even smaller.}. See \autoref{sec:rec.ts-file} for more
information about.

\section{The \texttt{meta.dat} File}
\label{sec:meta.dat-file}

This file is essential for records. If it is missing the \Comag does not
longer recognize the record. The structure of the file is shown in
\autoref{tab:meta.dat-structure}. Column ``Pos.'' shows the hexadecimal
position of the information from the start of the file starting with
00. Column ``Length'' gives the length of the information. A ``Word'' consists
of two bytes with low byte first. A ``Long'' consists of two Word with low
Word first. \emph{Unknown} bytes may have different values. \emph{Fixed} bytes
have always the same value. \emph{Reserved} bytes are fixed bytes with value
0x00.

\begin{table}\small
  \centering
  \ifx \Htmltrue\UnDef
  \captionabove{Structure of the file \texttt{meta.dat}}
  \else
  \captionabove{Structure of the file meta.dat}
  \fi
  \begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}r@{~}ll>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \multicolumn2l{Length} & Semantic & Comment\tabularnewline
    \midrule
    00 & 5  & Bytes & \textcolor{unsure}{unknown}       
                                    & \textcolor{unsure}{seems to be a fixed:
                                      \texttt{05 00 72 6a 07}}
                                      \tabularnewline
    05 & 7  & Bytes & reserved      & \tabularnewline
    0c & 1  & Byte  & type of title & 8 = transmission, 2 = station or manual
                                      input\tabularnewline
    0d & 62 & Byte  & title         & \texttt{NUL} terminated
                                      string, ISO-8859-1 encoded\tabularnewline
    4b &  1 & Byte  & hour (start time) & GMT is used!\tabularnewline
    4c &  1 & Byte  & minute (start time) & \tabularnewline
    4d &  1 & Byte  & second (start time) & \tabularnewline
    4e &  1 & Word  & reserved            & \tabularnewline
    50 &  1 & Word  & year (start time)   & \tabularnewline
    52 &  1 & Byte  & month (start time)  & \tabularnewline
    53 &  1 & Byte  & day (start time)    & \tabularnewline
    54 &  1 & Byte  & weekday (start time) & 0 = Sunday, 1 = Monday
                                             \dots\tabularnewline
    55 &  3 & Bytes & reserved      & \tabularnewline
    58 &  1 & Long  & info packets  & absolute number of Comag info
                                      packets at all ts files of the
                                      TS\tabularnewline
    5c &  1 & Byte  & hours (duration) & \tabularnewline
    5d &  1 & Byte  & minutes (duration) & \tabularnewline
    5e &  1 & Byte  & seconds (duration) & \tabularnewline
    5f &  1 & Byte  & reserved      & \tabularnewline
    60 &  1 & Byte  & service       & 0 = TV, 1 = Radio\tabularnewline
    61 &  3 & Bytes & reserved      & \tabularnewline
    64 &  1 & Byte  & \textcolor{unsure}{fixed 01}      & \textcolor{unsure}{semantic unknown}\tabularnewline
    65 &  3 & Bytes & reserved      & \tabularnewline
    68 &  1 & Word  & PID           & the program ID\tabularnewline
    6a &  2 & Bytes & reserved      & \tabularnewline
    6c &  1 & Long  & timer number  & All records are done by timers and this
                                      is the number of the timer used for the
                                      record.\tabularnewline
    \midrule
    \multicolumn{5}{@{}p{\linewidth}@{}}{%
      \textbf{Important Note:} The values of Word and Long are big-endians,
      that means the first byte of a multi byte value is the low byte and the
      last is the highest one!}\tabularnewline
    \bottomrule
  \end{tabularx}
  \label{tab:meta.dat-structure}
\end{table}

\paragraph{Example:} \textcolor{unsure}{Unsure} and
\textcolor{unknown}{Unknown} bytes are colored to mark them.
{\small
\begin{alltt}
00000000  \textcolor{unsure}{05 00 72 6a 07} 00 00 00  00 00 00 00 08 4a 61 6d  |..rj.........Jam|
00000010  65 73 20 42 6f 6e 64 20  30 30 37 20 2d 20 49 6d  |es Bond 007 - Im|
00000020  20 47 65 68 65 69 6d 64  69 65 6e 00 00 00 00 00  | Geheimdien.....|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 13 37 00 00 00  |............7...|
00000050  d8 07 07 08 02 00 00 00  6e 2e 01 00 02 0f 05 00  |........n.......|
00000060  00 00 00 00 \textcolor{unsure}{01} 00 00 00  cf 6d 00 00 00 00 00 00  |.........m......|
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}l>{\ttfamily}l>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & Semantic & Value & Explain\tabularnewline
    \midrule
    00 & \textcolor{unsure}{unknown or fixed} & \textcolor{unsure}{05 00 72 6a 07} & \tabularnewline
    05 & reserved      & 00 00 00 00 00 00 00 & \tabularnewline
    0c & type of title & 08 & transmission\tabularnewline
    0d & title         & James Bond 007 - Im Geheimdien & \tabularnewline
    4b & hour (start time) & 13 & 19 o'clock (using UTC)\tabularnewline
    4c & minute (start time) & 37 & 55 minutes\tabularnewline
    4d & second (start time) & 00 & 0 seconds\tabularnewline
    4e & reserved            & 0000 & \tabularnewline
    50 & year (start time)   & 07d8 & 2008\tabularnewline
    52 & month (start time)  & 07 & july\tabularnewline
    53 & day (start time)    & 08 & 8th\tabularnewline
    54 & weekday (start time) & 02 & Tuesday\tabularnewline
    55 & reserved      & 00 00 00 & \tabularnewline
    58 & info packets  & 00012e6e & 77422\tabularnewline
    5c & hours (duration) & 02 & 2 hours\tabularnewline
    5d & minutes (duration) & 0f & 15 minutes\tabularnewline
    5e & seconds (duration) & 05 & 5 seconds\tabularnewline
    5f & reserved      & 00 & \tabularnewline
    60 & service       & 00 & TV\tabularnewline
    61 & reserved      & 00 00 00\tabularnewline
    64 & \textcolor{unsure}{fixed 01} 
                       & \textcolor{unsure}{01} 
                            & \textcolor{unsure}{unknown}\tabularnewline
    65 & reserved      & 00 00 00& \tabularnewline
    68 & PID           & 6dcf & 28111\tabularnewline
    6a & reserved      & 00 00 & \tabularnewline
    6c & timer number  & 00000000 & 0\tabularnewline
    \bottomrule
  \end{tabularx}

\paragraph{Note:} Some bytes of the \texttt{meta.dat} are still unknown. We
have to do more experiments to get more information about those:
\setkomafont{labelinglabel}{\ttfamily}%
\setkomafont{labelingseparator}{\normalfont}%
\begin{labeling}[:]{99-99}
\item[00--04] I was told, that these are not fixed \texttt{05 00 72 6a 07},
  but no informations about other values and meaning are available.
\item[64] This may be the kind of timer (once, daily, weekdaily, weekly,
  \dots). In this case it would not be fixed \texttt{01}!
\end{labeling}
All reserved bytes may also have a unknown meaning. If anyone has different
information about them, please contact.

\section{The \texttt{rec.ts}, \texttt{rec.01}, \texttt{rec.02} \dots Files}
\label{sec:rec.ts-file}

These files are the MPEG transport stream of the record. A normal MPEG
transport stream of the \Comag exists of 5 header packets, video packets of a
single video stream, audio packets of up to two audio streams, private packets
with EPG\footnote{EPG = electronic program guide}, private packets with
VTX\footnote{VTX = video text}, optional private packets with additional AUDIO
streams, e.g., AC3 sound, null packets, PAT\footnote{PAT = program accociation
  table} packets and PMT\footnote{PMT = program map table} packets.

The header, which we call \emph{Comag TS header}, consists of two null
packets, followed by a PMT packet, followed by a PAT packet, followed by one
more PMT packet. Starting with the 513th packet every 512th packet is a null
packet followed by a PAT and a PMT packet. We call this the \emph{Comag TS
  info block}.

The \emph{Comag TS header} and the \emph{Comag TS info block} are essential
for the receiver. If they are missing or broken, the \Comag cannot play the
record an may even hang up.

The complete MPEG transport stream is splitted into files with size less than
2\;GBytes. Only the first starts with a Comag TS header. All others start with
a Comag TS info block. Because of this splitting is only allowed before a
Comag TS info block.


\subsection{General Information about TS}
\label{sec:ts-general}

MPEG transport streams (TS) consists of single packets of 188 octets. An octet
are 8~bits. For building bytes from octets you have to but the first sended
bit of the octet into the highest bit of the byte, the second sendes bit into
the second highest bit of the byte and so on until the 8th sended bit will
stay in the lowest bit of the byte. So a data stream of 10101010 (first sendes
bit is the right most) will become the Byte 0x33. We use bytes in this
documentation!

Many general informations about TS may be found at \cite{iso13818-1},
\cite{iso13818-2}, \cite{iso13818-3}, and \cite{iso13818-4}. The \Comag uses
only some packets. So we describe only them in this document. The general
structure of TS~packets may be found at \autoref{tab:ts-general}.

\begin{table}\small
  \centering
  \captionabove{General structure of a transport stream packet}
  \begin{tabularx}{\textwidth}{>{\ttfamily}ll>{\raggedright}X}
    \toprule
    \multicolumn1l{Name} & No. of bits & Comment \tabularnewline
    \midrule
    sync\_byte                    &  8 & must be 0100\,0111 (0x47) 
                                        \tabularnewline
    transport\_error\_indicator  &  1 & set if there is an error at the packet
                                        \tabularnewline
    payload\_unit\_start\_indicator &  1 & set if payload starts with the first
                                        bytes of a PES or a PSI packet
                                        \tabularnewline
    transport\_priority          &  1 & set if the packet has priority above
                                        other packets\tabularnewline
    PID                          & 13 & type of data see \autoref{tab:PID}
                                        \tabularnewline
    transport\_scrambling\_control &  2 & scrambling mode for the
                                        \texttt{data\_byte[]} only; 
                                        Null packets should never be
                                        scrambled; 00 = not scrambled
                                        \tabularnewline
    adaptation\_field\_control   &  2 & 00 = reserved\\
                                        01 = no adaptation field, payload at
                                        \texttt{data\_byte[]}\\
                                        10 = adaptation field, no payload\\
                                        11 = adaptation field, payload at
                                        \texttt{data\_byte[]}
                                        \tabularnewline
    continuity\_counter          &  4 & used to recognize duplicate packets
                                        \tabularnewline
    adaptation\_field            &$8N$& for size see description of adaptation
                                        field
                                        \tabularnewline
    data\_byte[]                 &$8S$& PES, PSI, stuffing, private data;
                                        $S = 184 - N$
                                        \tabularnewline
    \bottomrule
  \end{tabularx}
  \label{tab:ts-general}
\end{table}

\begin{table}
  \centering
  \captionabove{PID table}
  \begin{tabularx}{\textwidth}{>{\ttfamily}l>{\raggedright}X}
    \toprule
    \multicolumn1l{PID} & Description \tabularnewline
    \midrule
    0x0000 & Program Association Table \tabularnewline
    0x0001 & Conditional Access Table \tabularnewline
    0x0002 & Transport Stream Description Table \tabularnewline
    0x0003--0x000f & Reserved \tabularnewline
    0x0010--0x1ffe & May be assigned as network PID, Program map PID,
    elementary PID, Audio PID, Video PID, EPG PID, VTX PID, or for other
    purposes (it seems that the \Comag uses 0x0012 for EPG) \tabularnewline
    \bottomrule
  \end{tabularx}
  \label{tab:PID}
\end{table}

\paragraph{Additional information to some elements of the TS~packet:}
\setkomafont{descriptionlabel}{\ttfamily}
\begin{description}
\item[sync\_byte] -- In theory the TS does not need to start with a packet and
  one packet does not need to follow a packet. Packets may be recognized by a
  \emph{sync\_byte} byte. But it seams that at the records of the \Comag the
  files consists only of packets and no \emph{garbage} may be found before the
  first packet or between packets.
\item[payload\_unit\_start\_indicator] -- PES or PSI packets may be longer
  than 184~bytes minus the length of an optional adaptation field. At the
  first TS packet of a PES or PSI packet this bit should be 1. If no PES or
  PSI packet starts at the TS packet the bit should be 0.

  For null packets the \texttt{payload\_unit\_start\_indicator} should also be
  0.

  For private data not of \texttt{stream\_type} 5 or 6 the meaning is not
  defined.
\item[transport\_priority] -- Depending on the decoder this bit may be related
  to the PID of the packet or not.
\item[PID] -- An general overview of the PIDs may be found in
  \autoref{tab:PID}. Important for the \Comag are null packets with PID
  0x1fff, that may be Comag info packets, program association table (PAT) with
  PID 0x0000, and audio, videom and program map table (PMT) with PID
  0x0010\dots 0x1ffe.
\item[transport\_scrambling\_control] -- This document does not handle
  scambled data, so this should be 00 at least for private packets, PAT, and
  PMT.
\item[adaptation\_field\_control] -- We split this into \texttt{AF} and
  \texttt{PD}. The first (topmost) bit is \texttt{AF}. If \texttt{AF} was set,
  the \texttt{adaptation\_field} is used and $N$ ist not 0. The second (lower)
  bit is \texttt{PD}. If \texttt{PD} was set, the \texttt{data\_byte[]} array
  has payload data and not only suffing bytes.
\item[continuity\_counter] -- This value is PID dependent. It increases for
  every packets with the same PID. If two consecutive TS packets have the same
  PID and the same \texttt{continuity\_counter} they are
  duplicates. Duplicates may be send for synchronization purpose.
\item[adaptation\_field] -- The adaptation field may have several data. Most
  interesting are PCR and DTS, that are clock informations. Detailed
  information about the adaptation field may be found at
  \autoref{sec:adaptation-field}.
\item[{data\_byte[]}] -- This array may contain either of stuffing bytes 0xff or
  of payload. Payload is the data of private packets, null packets, PES, PSI.
\end{description}


\subsection{Adaptation Field at Transport Stream Packets}
\label{sec:adaptation-field}

The adaptation field may have several data. Most interesting are PCR and DTS,
that are clock informations. The adaptation field may also used for stuffing
at packets with PES packets. The general structure of adaptation fields may be
found at \autoref{tab:adaptation-field}. The adaptation field is only part of
the TS~packet if the \texttt{AF} is 1.

\begin{table}\small
  \begin{addmargin}[-4em]{-4em}
    \addtolength{\textwidth}{8em}
  \captionabove{General structure of the adaptation field}
  \begin{tabularx}{\textwidth}{>{\ttfamily}lr>{\raggedright}X}
    \toprule
    \multicolumn1l{Name} & \hspace{-2em}No. of bits & Comment \tabularnewline
    \midrule
    adaptation\_field\_length      &  8 & \tabularnewline
    discontinuity\_indicator       &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    random\_access\_indicator      &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    elementary\_stream\_priority\_indicator 
                                   &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    PCR\_flag                      &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    OPCR\_flag                     &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    splicing\_point\_flag          &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    transport\_private\_data\_flag &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    adaptation\_field\_extension\_flag 
                                   &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    program\_clock\_reference\_base
                                   & 33 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    reserved                       &  6 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    program\_clock\_reference\_extension 
                                   &  9 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    original\_program\_clock\_reference\_base
                                   & 33 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    reserved                       &  6 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    original\_program\_clock\_reference\_extension 
                                   &  9 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    splice\_countdown              &  8 & only if 
                                          $\texttt{splicing\_point\_flag} = 1$
                                          \tabularnewline
    transport\_private\_data\_length
                                   &  8 & only if 
                                          $\mathtt{transport\_private\_data\_flag}
                                          = 1$
                                          \tabularnewline
    transport\_private\_data\_byte[] 
                                   &$8P$& $P =
                                          \mathtt{transport\_private\_data\_length}$
                                          \tabularnewline
    adaptation\_field\_extension\_length
                                   &  8 & only if
                                          $\mathtt{adaptation\_field\_extension\_flag}
                                          = 1$
                                          \tabularnewline
    ltw\_flag                      &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    piecewise\_rate\_flag          &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    seamless\_splice\_flag         &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    reserved                       &  5 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    ltw\_valid\_flag               &  1 & only if
                                          $\mathtt{ltw\_flag} = 1$
                                          \tabularnewline
    ltw\_offset                    & 15 & only if
                                          $\mathtt{ltw\_flag} = 1$
                                          \tabularnewline
    reserved                       &  2 & only if
                                          $\mathtt{piecewise\_rate\_flag} = 1$
                                          \tabularnewline
    piecewise\_rate                & 22 & only if
                                          $\mathtt{piecewise\_rate\_flag} = 1$
                                          \tabularnewline
    splice\_type                   &  4 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[32..30]          &  3 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[29..15]          & 15 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[14..0]           & 15 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    reserved[]                     &$8R$& only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 1$
                                          \tabularnewline
    stuffing\_data[]               &$8D$& only if
                                          $\mathtt{adaptation\_field\_length}
                                          > 1$
                                          \tabularnewline
   \bottomrule
  \end{tabularx}
  \label{tab:adaptation-field}
  \end{addmargin}
\end{table}

\paragraph{Additional information to some elements of the adaptation field:}
\setkomafont{descriptionlabel}{\ttfamily}
\begin{description}
\item[adaptation\_field\_length] -- If this is 0x00 no more data follows in
  the adaptation field and the \texttt{adaptation\_field\_length} is a kind of
  single stuffing byte.
\item[discontinuitiy\_indicator] -- If this is not present it is 0. If it is
  1, it indicates a discontinuity either of system time-base or
  \texttt{continuity\_counter}.

  See \cite[section~2.4.3.5]{iso13818-1} for information about system
  time-base discontinuity.

  See \cite[section~2.4.3.5]{iso13818-1} for information about
  \texttt{continuity\_counter} discontinuity.
\item[random\_acess\_indicator] -- See \cite[section~2.4.3.5]{iso13818-1} for
  information about this.
\item[elementary\_stream\_priority\_indicator] -- See
  \cite[section~2.4.3.5]{iso13818-1} for information about this.
\item[PCR\_flag] -- 1 indicates a PCR field at the adaptation field.
\item[OPCR\_flag] -- 1 indicates a OPCR field at the adaptation field.
\item[splicing\_point\_flag] -- 1 indicates a \texttt{splice\_countdown} field
  in the adaptation field.
\item[transport\_private\_data\_flag] -- 1 indicates one or more
  \texttt{transport\_private\_data\_byte} in the adaptation field.
\item[adaptation\_field\_extension\_flag] -- 1 indicates adaptation field
  extensions at the adaptation field.
\item[program\_clock\_reference\_base; program\_clock\_referenc\_extension]
  The program clock reference (PCR) is a 42~bit~value giving the program clock
  in 27~MHz. It is calculated:
  \begin{align}
  \mathrm{PCR} &= 300 \cdot \mathtt{program\_clock\_reference\_base} \notag\\
               &+ \mathtt{program\_clock\_reference\_extension}\,.
  \end{align}
\item[original\_program\_clock\_reference\_base] -- See
  \texttt{program\_clock\_reference\_base}.
\item[original\_program\_clock\_referenc\_extension] -- See
  \texttt{program\_clock\_referenc\_extension}.
\item[splice\_countdown] -- See
  \cite[section~2.4.3.5]{iso13818-1} for information about this.
\item[transport\_private\_data\_length] -- The length of the data at the
  immediate following \texttt{transport\_private\_data\_byte[]}. The data
  itself should not extends beyound the adaptation field. So the
  \texttt{transport\_private\_data\_length} should be at least less than 181
  and even lesser if PCR, OPCR or \texttt{splice\_dountdown} are used.
\item[{transport\_private\_data\_byte[]}] -- The data of this field is no
  specified by IEC.
\item[adaptation\_field\_extension\_length] -- The length of the 
  immediate following data including reserved bytes if pressent.
\item[ltw\_flag] -- 1 indicates \texttt{ltw\_valid} and \texttt{ltw\_offset} at
  the extension.
\item[piecewise\_rate\_flag] -- 1 indicates \texttt{piecewise\_rate} at the
  extension.
\item[seamless\_splice\_flag] -- 1 indicate \texttt{splice\_type},
  \texttt{DTS\_next\_AU} and the \texttt{marker\_bit}s at the extension. Note,
  that it should be 1 only if the \texttt{splicing\_point\_flag} is 1 too.
\item[ltw\_valid\_flag] -- 1 indicates, that the value of \texttt{ltw\_offset}
  is valid. 0 indicates, that the value of \texttt{ltw\_offset} is undefined.
\item[ltw\_offset] -- See
  \cite[section~2.4.3.5]{iso13818-1} for information about this.
\item[piecewise\_rate] -- The value of this is only valid if both
  \texttt{ltw\_flag} and \texttt{ltw\_valid\_flag} are set to 1. See
  \cite[section~2.4.3.5]{iso13818-1} for information about this.
\item[splice\_type] -- See
  \cite[section~2.4.3.5]{iso13818-1} for information about this.
\item[DTS\_next\_AU]  -- 33 bit value of the DTS. 
\item[{stuffing\_data[]}] -- All these bytes are 1111\,1111 (0xff). They are
  used to stuff the TS packet to 188 bytes.
\end{description}

\begin{samepage}
\paragraph{Example:} The \Comag uses the adaptation field for PCR like
  following: {\small
\begin{alltt}
00000000   07 10 3f 62 a8 6d ff 0a                          |.?b.m..|
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r>{\ttfamily}l>{\ttfamily}l>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \textrm{Semantic} & Value & Explain\tabularnewline
    \midrule
    00:   & adaptation\_field\_length & 07 & 7 bytes of adaptation field are
    following\tabularnewline
    01:   & \textrm{Flags:}           & 10 & 8 Flags:\tabularnewline
         & discontinuity\_indicator  & 0 & no discontinuity\tabularnewline
         & random\_access\_indicator & 0 & no random access\tabularnewline
         & elementary\_stream\_priority\_indicator 
                                     & 0 & no stream priority\tabularnewline
         & PCR\_flag                 & 1 & PCR at adaptation
                                           field\tabularnewline
         & OPCR\_flag                & 0 & no OPCR at adaptation
                                           field\tabularnewline 
         & splicing\_point\_flag     & 0 & no \texttt{splice\_countdown}
                                           \tabularnewline
         & transport\_private\_data\_flag
                                     & 0 & no transport private data at
                                           adaptation field\tabularnewline
         & adaptation\_field\_extension\_flag
                                     & 0 & no adaptation field
                                     extension\tabularnewline
    02:   & \textrm{PCR:}             & 3f62a86dff0a 
                                         & PCR is $638058152366\cdot
                                           27\mathrm{MHz}$ or
                                           06:33:51.783420 calculated by:
                                           \tabularnewline
         & program\_clock\_reference\_base 
                                     & 07ec550db 
                                         & 33 bits:
                                         \hphantom{000}0\,0111\,1110\,\linebreak[1]%
                                         1100\,0101\,0101\,\linebreak[1]%
                                         0000\,1101\,1011\tabularnewline
         & program\_clock\_reference\_extension
                                     & 10a & 9 bits: 
                                            \hphantom{000}1\,0000\,1010
                                     \tabularnewline
         & reserved                  & 37 & 6 bits: 11\,0111\tabularnewline
    \bottomrule
\end{tabularx}
\end{samepage}

\subsection{Comag TS Header}
\label{sec:comag-ts-header}

The header consists of 5 packets: null packet, null packet, PMT packet, PAT
packet, PMT packet. The second PMT packet is a copy if the first one. The
second null packet consists of payload with stuffing bytes\footnote{Stuffing
  bytes are 0xff.} only. The first null packet is called \emph{Comag info
  packet}. The general structure of this packet is shown in
\autoref{tab:comag-info-packet}. The general structure of this packet is same
in the header and the info block (see \autoref{sec:comag-ts-info-block}). But
some values are valid at only either the header or the info block and 0
otherwise.

\paragraph{Example of the Comag info packet at the header:} This example shows
not only the payload but the whole packet. You have to remove four bytes from
start to get the payload only. \textcolor{unsure}{Unsure} and
\textcolor{unknown}{Unknown} bytes are colored to mark them.

{\small
\begin{alltt}
00000000  47 1f ff 10 \textcolor{unsure}{02 32 23 10  01} 00 00 00 00 00 00 00  |G....2\#.........|
00000010  2e 49 01 00 fe 80 85 00  04 00 00 00 59 02 5a 02  |.I..........Y.Z.|
00000020  12 00 5c 02 00 00 00 00  00 00 00 00 01 02 00 04  |..\textbackslash.............|
00000030  00 00 00 00 00 00 00 00  72 65 67 00 00 00 00 00  |........reg.....|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000060  08 4a 61 6d 65 73 20 42  6f 6e 64 20 30 30 37 20  |.James Bond 007 |
00000070  2d 20 49 6d 20 47 65 68  65 69 6d 64 69 65 6e 00  |- Im Geheimdien.|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 26 57 00 00  |............\&W..|
000000b0  04 00 00 00 00 00 00 00  00 00 00 00              |............|
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r>{\ttfamily}l>{\ttfamily\raggedleft}p{6em}>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \textrm{Semantic} & \textrm{Value} & Explain\tabularnewline
    \midrule
    00: & sync\_byte                    & 47   & Sync byte of the ts packet
                                                 \tabularnewline
    01: & \textrm{Flags \&} PID         & 1fff & In detail:\tabularnewline
        & \makebox[11em][l]{transport\_error\_indicator}   &    0 & no error\tabularnewline
        & \makebox[11em][l]{payload\_unit\_start\_indicator} &  0 & not PES or PSI start at
                                                 packet
                                                 \tabularnewline
        & transport\_priority           &    0 & no priority above other
                                                 packets
                                                 \tabularnewline
        & PID                           & 1fff & PID of null packet
                                                 \tabularnewline
    03: & \textrm{Flags \&} continuity\_counter &   10 & always 10
                                                 \tabularnewline
    04: & \textcolor{unsure}{magic}     & \textcolor{unsure}{0232231001}
                                               & \textcolor{unsure}{magic
                                                 header}
                                                 \tabularnewline
    09: & reserved                      & 0    & always 0\tabularnewline
    10: & info\_packets                 & 00012e49 & 77385 info packets a the
                                                 record
                                                 \tabularnewline
    14: & duration                      & 008590fe & record takes 8749310\,ms =
                                                 02:25:49.310
                                                 \tabularnewline
    18: & streams\_used                 & 00000004 & 4 stream PIDs
                                                 \tabularnewline
    1c: & pid[8]                        & 0259 & 1st stream PID: 
                                                 601\tabularnewline
        &                               & 025a & 2nd stream PID:
                                                 602\tabularnewline
        &                               & 0012 & 3rd stream PID:
                                                 18\tabularnewline
        &                               & 025c & 4th stream PID:
                                                 604\tabularnewline
        &                               &    0 & 5th until 8th are unused and 0
                                                 \tabularnewline
    2c: & stream\_type[8]                  &   01 & 1st stream: 
                                                 video\tabularnewline
        &                               &   02 & 2nd stream:
                                                 audio\tabularnewline
        &                               &   00 & 3rd stream:
                                                 EPG\tabularnewline
        &                               &   04 & 3rd stream:
                                                 VTX\tabularnewline
        &                               &    0 & 5th until 8th are unused and
                                                 0\tabularnewline
    34: & stream\_lang[8]               & 00000000 & 1st stream language\tabularnewline
        &                               & 72656700 & 2nd stream language: ger
        = german\tabularnewline
        &                               & 00000000 & 3rd stream language\tabularnewline
        &                               & 00000000 & 4th stream language\tabularnewline
        &                               & 00000000 & 5th stream language\tabularnewline
        &                               & 00000000 & 6th stream language\tabularnewline
        &                               & 00000000 & 7th stream language\tabularnewline
        &                               & 00000000 & 8th stream language\tabularnewline
    54: & elapsed\_time                 & 00000000 & Start of record\tabularnewline
    58: & unknown\_1                    & 00000000 & Start of record\tabularnewline
    5c: & reserved\_3                   &    0 & \tabularnewline
    60: & title\_type                   &   08 & transmission (from EPG)\tabularnewline
    61: & title                         & James Bond 007 - Im Geheimdien &
    Some characters from the movie title\tabularnewline
    9f: & reserved\_4                   &    0 & \tabularnewline
    ac: & sections\_per\_file           & 0x00005726 & 22310 sections/file =
                                                       11422720 packets/file =
                                                       2147471360 bytes/file
                                                       \tabularnewline
    b0: & stream\_files                 & 00000004 & 4 stream files
                                                 \texttt{rec.ts}, 
                                                 \texttt{rec.01}, 
                                                 \texttt{rec.02}, and
                                                 \texttt{rec.03}\tabularnewline 
    b4: & reserved\_5                   &    0 & \tabularnewline
    \bottomrule
\end{tabularx}

\subsection{Comag TS Info Block}
\label{sec:comag-ts-info-block}

The info block consists of a \emph{Comag info packet} (see
\autoref{tab:comag-info-packet}) followed by PAT and a PMT packet. The Comag
info packet differs from the one in the header. Some values are same, some are
updated and some are 0 always. The PAT and PMT packets are copies of the PAT
and PMT packets from the header (see \autoref{sec:comag-ts-header}).

\paragraph{Example of the Comag info packet at the info block:} This example shows not only the
payload but the whole packet. You have to remove four bytes from start to get
the payload only. \textcolor{unsure}{Unsure} and \textcolor{unknown}{Unknown}
bytes are colored to mark them.

{\small
\begin{alltt}
00000000  47 1f ff 10 \textcolor{unsure}{02 32 23 10  01} 00 00 00 00 00 00 00  |G....2\#.........|
00000010  00 00 00 00 00 00 00 00  04 00 00 00 59 02 5a 02  |............Y.Z.|
00000020  12 00 5c 02 00 00 00 00  00 00 00 00 01 02 00 04  |..\textbackslash.............|
00000030  00 00 00 00 00 00 00 00  72 65 67 00 00 00 00 00  |........reg.....|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 b9 39 24 00  \textcolor{unknown}{e8 d2 77 00} 00 00 00 00  |.....9\$...w.....|
00000060  08 4a 61 6d 65 73 20 42  6f 6e 64 20 30 30 37 20  |.James Bond 007 |
00000070  2d 20 49 6d 20 47 65 68  65 69 6d 64 69 65 6e 00  |- Im Geheimdien.|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00              |............|
\end{alltt}}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r>{\ttfamily}l>{\ttfamily\raggedleft}p{6em}>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \textrm{Semantic} & \textrm{Value} & Explain\tabularnewline
    \midrule
    00: & sync\_byte                    & 47   & Sync byte of the ts packet
                                                 \tabularnewline
    01: & \textrm{Flags \&} PID         & 1fff & In detail:\tabularnewline
        & \makebox[11em][l]{transport\_error\_indicator}   &    0 & no error\tabularnewline
        & \makebox[11em][l]{payload\_unit\_start\_indicator} &  0 & not PES or PSI start at
                                                 packet
                                                 \tabularnewline
        & transport\_priority           &    0 & no priority above other
                                                 packets
                                                 \tabularnewline
        & PID                           & 1fff & PID of null packet
                                                 \tabularnewline
    03: & \textrm{Flags \&} continuity\_counter &   10 & always 10
                                                 \tabularnewline
    04: & \textcolor{unsure}{magic}     & \textcolor{unsure}{0232231001}
                                               & \textcolor{unsure}{magic
                                                 header}
                                                 \tabularnewline
    09: & reserved                      & 0    & always 0\tabularnewline
    10: & info\_packets                 & 0    & always 0 at Comag TS info block
                                                 \tabularnewline
    14: & duration                      &    0 & always 0 at Comag TS info block
                                                 \tabularnewline
    18: & streams\_used                 & 00000004 & 4 stream PIDs
                                                 \tabularnewline
    1c: & pid[8]                        & 0259 & 1st stream PID: 
                                                 601\tabularnewline
        &                               & 025a & 2nd stream PID:
                                                 602\tabularnewline
        &                               & 0012 & 3rd stream PID:
                                                 18\tabularnewline
        &                               & 025c & 4th stream PID:
                                                 604\tabularnewline
        &                               &    0 & 5th until 8th are unused and 0
                                                 \tabularnewline
    2c: & stream\_type[8]                  &   01 & 1st stream: 
                                                 video\tabularnewline
        &                               &   02 & 2nd stream:
                                                 audio\tabularnewline
        &                               &   00 & 3rd stream:
                                                 EPG\tabularnewline
        &                               &   04 & 3rd stream:
                                                 VTX\tabularnewline
        &                               &    0 & 5th until 8th are unused and
                                                 0\tabularnewline
    34: & stream\_lang[8]               & 00000000 & 1st stream language\tabularnewline
        &                               & 72656700 & 2nd stream language: ger
        = german\tabularnewline
        &                               & 00000000 & 3rd stream language\tabularnewline
        &                               & 00000000 & 4th stream language\tabularnewline
        &                               & 00000000 & 5th stream language\tabularnewline
        &                               & 00000000 & 6th stream language\tabularnewline
        &                               & 00000000 & 7th stream language\tabularnewline
        &                               & 00000000 & 8th stream language\tabularnewline
    54: & elapsed\_time                 & 002439b9 & duration until now:
                                                 2374073\,ms = 00:39:34.073
                                                 \tabularnewline
    58: & \textcolor{unknown}{unknown\_1} 
                                        & \textcolor{unknown}{e8 d2 77 00} 
                                               & \textcolor{unknown}{???}
                                                 \tabularnewline
    5c: & reserved\_3                   &    0 & \tabularnewline
    60: & title\_type                   &   08 & transmission (from EPG)\tabularnewline
    61: & title                         & James Bond 007 - Im Geheimdien &
    Some characters from the movie title\tabularnewline
    9f: & reserved\_4                   &    0 & \tabularnewline
    ac: & sections\_per\_file           &    0 & always 0 at Comag TS info block
                                                 \tabularnewline
    b0: & stream\_files                 &    0 & always 0 at Comag TS info block
                                                 \tabularnewline
    b4: & reserved\_5                   &    0 & \tabularnewline
    \bottomrule
\end{tabularx}

Note, that all not 0 values unless \texttt{elapsed\_time} and
\texttt{unknown\_1} are copies from the Comag info packet at the Comag TS
header. Only \texttt{elapsed\_time} and \texttt{unknown\_1} change from Comag
TS info block to Comag TS info block!


\subsection{Comag info packet}

The Comag info packet is a null packet with special contents. The general
structure is same as Comag TS header (see \autoref{sec:comag-ts-header}) and
Comag TS info block (see \autoref{sec:comag-ts-info-block}). Some values are
only used at the header and 0 at the info block, some are only used at the
info block and 0 at the header, some are updated at every info block and some
are same at header and every info block.

The Comag info packet has not adaptation field but payload. So the first 4
bytes of the packet are \texttt{47 1f ff 10}. The general structure of the
payload may be found at \autoref{tab:comag-info-packet}. Examples are shown at
\autoref{sec:comag-ts-header} and \autoref{sec:comag-ts-info-block}.

\begin{table}\small
  \begin{addmargin}[-4em]{-4em}
    \addtolength{\textwidth}{8em}
    \captionabove{General structure of the payload of Comag info packet}
    \label{tab:comag-info-packet}
    \begin{tabularx}{\textwidth}{>{\ttfamily}lr>{\raggedright}X}
      \toprule
      \multicolumn1l{Name} & \hspace{-2em}No. of bytes & Comment
      \tabularnewline
      \midrule
      \textcolor{unsure}{magic}
                           & \textcolor{unsure}{5} 
                                & \textcolor{unsure}{%
                                  A magic number of 5\,bytes indicating the
                                  null packet to be a Comag info packet:\\
                                  \texttt{02 32 23 10 01}}
                                  \tabularnewline
      reserved\_1          &  7 & always 0\tabularnewline
      info\_packets        &  4 & number of Comag info packets in the
                                  transport stream
                                  \tabularnewline
      duration             &  4 & duration of the record
                                  \tabularnewline
      streams\_used        &  4 & number of video, audio, EPG and VTS streams
                                  \tabularnewline
      pid[8]               & 16 & 8 two byte values of used streams;
                                  the first \texttt{streams\_used} of these
                                  values are valid, the others should be 0
                                  \tabularnewline
      stream\_type[8]         &  8 & 8 bytes to indicate the type of streams:\\
                                  \texttt{00}: EPG stream\\
                                  \texttt{01}: video stream\\
                                  \texttt{02}: audio stream\\
                                  \texttt{04}: VTX stream
                                  \tabularnewline
      stream\_language[8]  & 32 & The languages of the streams.\\
                                  Only audio streams have a language.\\
                                  The language is a big-endian-value of a
                                  three character language code, e.g.,
                                  72656700 for \emph{ger}, 65726600 for
                                  \emph{fre} etc.\tabularnewline
      elapsed\_time        &  4 & elapsed duration of the record in ms
                                  (1\,kHz)
                                  \tabularnewline
      \textcolor{unknown}{unknown\_1} 
                           &  4 & \tabularnewline
      reserved\_3          &  4 & always 0\tabularnewline
      title\_type          &  1 & Type of title:\\
                                  \texttt{02} = station or manual input\\
                                  \texttt{08} = transmission (by EPG)
                                  \tabularnewline
      title                & 62 & NUL terminating string with title of record
                                  \tabularnewline
      reserved\_4          & 13 & always 0\tabularnewline
      sections\_per\_file  &  4 & number of sections (each section starts with
                                  either a Comag info header or a Comag info
                                  block) after that the next ts file must be
                                  opened
                                  \tabularnewline
      stream\_files        &  4 & number of files the complete transport
                                  stream consists of
                                  \tabularnewline
      reserved\_5          &  8 & always 0
                                  \tabularnewline
      \midrule
      \multicolumn{3}{@{}p{\linewidth}@{}}{%
        \textbf{Important Note:} In difference to values of other packets like
        PAT or PMT or the values of the adaptation field, the values of the
        Comag info packets are big-endians, that means the first byte of a
        multi byte value is the low byte and the last is the highest one!}%
      \tabularnewline
      \bottomrule
    \end{tabularx}
  \end{addmargin}
\end{table}

\paragraph{Note:} Some bytes of the \texttt{Comag info packet} are still
unknown. We have to do more experiments to get more information about those:
\begin{labeling}[:]{99-99}
\item[00--04] We don't know if the magic number really consists of 5\,Bytes or
  if some of these bytes have special meanings.
\item[54--57] These bytes seam to be a four byte value, that increases
  rapidly, but we do not know anything about.
\item[a8--ab] These bytes are not 0 and not fixed, but we do not know anything
  about. 
\end{labeling}

\paragraph{Additional information to some elements of the Comag info packet:}
\setkomafont{descriptionlabel}{\ttfamily}
\begin{description}
\item[magic] -- This seams to be always the same.
\item[info\_packets] -- This is the number of Comag info packets at the
  transport stream of the record. If the transport stream consists of more
  than one file, it does not show the number of Comag info packets at the
  current file, but at all files together. It is valid only at the Comag TS
  header and 0 otherwise.
\item[duration] -- This is the duration of the complete transport stream if
  the record that may consists of many files. The value is in milliseconds or
  kHz.  It is valid only at the Comag TS header and 0 otherwise.
\item[streams\_used] -- This is the number of streams, the \Comag used at the
  transport stream. A stream may either be a video, an audio or an EPG or VTX
  stream. Up to 8 streams are possible.
\item[{pid[8]}] -- Array with the PID numbers of the used
  streams. \texttt{streams\_used} values should be not 0, all others should be
  0.
\item[{stream\_type[8]}] -- The types of the streams with the PIDs saved at
  \texttt{pid[8]}. EPG streams has the type~0, video streams the type~1, audio
  streams the type~2, and VTX streams the type~4. Other values currently not
  known.
\item[{stream\_lang[8]}] -- you may simply read/write the three characters of
  the language name from right to left with 4th byte is NUL.
\item[elapsed\_time] -- This is the current duration of the record in
  milliseconds (or kHz). It is 0 at the header and updated at the info blocks.
\item[unknown\_1] -- We really should know more about this but don't. It is 0
  at header and rapidly increasing (with overflow jumps) at the info blocks.
\item[title\_type] -- Currently only the two types are known. Type~8 is used
  by the \Comag at records using EPG. In this case the \texttt{title} is the
  title of the transmission e.g. the movie title. Type~2 is used for records
  using the REC key or a manual timer. In this case the title is the station
  by default and may be changed manually.
\item[title] -- A NUL-terminated string.  Currently only titles with encoding
  ISO-Latin-1 (aka ISO-8859-1) are known.  No explicite encoding information
  known.
\item[stream\_files] -- The \Comag splits streams into portions of less than
  2\,GBytes. The first file is named \texttt{rec.ts}, the next
  \texttt{rec.01}, followed by \texttt{rec.02} and so on. At the header, this
  value is the number of files. At the info blocks it is always 0.
\end{description}


\section{The \texttt{rec.bm} File}
\label{sec:rec.bm-file}

If this file is missing at a record, the receiver recreates an empty
one. The file saves the marks, e.g., for cutting. The already known structure
of that file is shown in \autoref{tab:rec.bm-structure}.

\begin{table}\small
  \centering
  \ifx \Htmltrue\UnDef
  \captionabove{Structure of the file \texttt{meta.dat}}
  \else
  \captionabove{Structure of the file meta.dat}
  \fi
  \label{tab:rec.bm-structure}
  \begin{tabularx}{\textwidth}{>{\ttfamily}rr@{~}ll>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \multicolumn2l{Length} & Semantic &
    Comment\tabularnewline
    \midrule
    000: &  4 & Bytes & \textcolor{unknown}{unknown} 
                                       & \texttt{ff ff ff ff 01}
                                         at empty \texttt{rec.bm} 
                                         \tabularnewline
    004: &  1 & Word  & next free mark & the number $M$ of the next free mark
                                        (\texttt{01} = 1 at empty files)
                                        \tabularnewline
    006: & 10 & Bytes & reserved       & seems to be 0\tabularnewline
    010: & $8\cdot(M-1)$ & Bytes & mark structures 
                                       & array of $(M-1)$ structures:
                                        \tabularnewline
         &  1 & Long  & time           & time in ms of first mark
                                         \tabularnewline
         &  1 & Long  & Comag info packet number 
                                       & number of the Comag info packet valid
                                         for the first mark\tabularnewline
    010$+8(M-1)$:
         & 25 & Bytes & reserved       & seems to be 0\tabularnewline
    041$+8(M-1)$:
         &  4 & Bytes & \textcolor{unsure}{end mark}       
                                       & seems to be a copy of 
                                         \texttt{000}--\texttt{003} at used
                                         files and 0 at empty files
                                         \tabularnewline
    --19f: &  &       & suffing bytes  & all these are 0
                                         \tabularnewline
    \bottomrule
  \end{tabularx}
\end{table}

\paragraph{Example of an empty \texttt{rec.bm}:} Empty files consist of four
Bytes 0xff, followed by one Byte 0x01, followed by 411 Bytes 0x00.

{\small
\begin{alltt}
00000000  ff ff ff ff 01 00 00 00  00 00 00 00 00 00 00 00  |................|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000170  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000180  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000190  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}l>{\ttfamily}l>{\raggedright}X}
  \toprule
  \multicolumn1{r@{\quad}}{Pos.} & Semantic & Value & Explain\tabularnewline
  \midrule
  00 & unknown         & \texttt{ff ff ff ff} & always same at empty files
                                                \tabularnewline
  04 & next free mark  & \texttt{0001}        & $M=1$, currently no mark set
                                                \tabularnewline
  06 & stuffing bytes  & \texttt{00}\dots     & all stuffing bytes are 0
                                                \tabularnewline
  \bottomrule
\end{tabularx}

\paragraph{Example of a used \texttt{rec.bm}:} Currently only some
informations are known.

{\small
\begin{alltt}
00000000  \textcolor{unknown}{89 1f 00 00} 0b 00 00 00  00 00 00 00 00 00 00 00  |................|
00000010  d0 eb 00 00 f2 02 00 00  fd d9 01 00 e0 05 00 00  |................|
00000020  ef c3 02 00 d4 08 00 00  cd ab 03 00 f1 0b 00 00  |................|
00000030  6a 98 04 00 e2 0e 00 00  d6 7e 05 00 c9 11 00 00  |j........~......|
00000040  b4 6c 06 00 0e 15 00 00  1c 55 07 00 f9 17 00 00  |.l.......U......|
00000050  42 41 08 00 49 1b 00 00  39 2b 09 00 95 1e 00 00  |BA..I...9+......|
00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000070  00 00 00 00 00 00 00 00  00 \textcolor{unknown}{89 1f 00 00} 00 00 00  |................|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000170  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000180  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000190  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}l>{\ttfamily}l>{\raggedright}X}
  \toprule
  \multicolumn1{r@{\quad}}{Pos.} & Semantic & Value & Explain\tabularnewline
  \midrule
  00 & \textcolor{unknown}{unknown}         & \textcolor{unknown}{\texttt{89 1f 00 00}} & \textcolor{unknown}{unknown}
                                                \tabularnewline
  04 & next free mark  & \texttt{000b}        & $M=11$, currently 10~marks set
                                                \tabularnewline
  06 & reserved        & \texttt{00}\dots     & \tabularnewline
  10 & time[0]         & \texttt{0000ebd0}    & 1st mark after 60368~ms
                                                (00:01:00.368)
                                                \tabularnewline
  14 & Comag info packet[0]
                       & \texttt{000002f2}    & 1st mark at Comag info packet
                                                number 754
                                                \tabularnewline
  18 & time[1]         & \texttt{0001d9fd}    & 2nd mark after 121341~ms
                                                (00:02:01.341)
                                                \tabularnewline
  1c & Comag info packet[1]
                       & \texttt{000005e0}    & 2nd mark at Comag info packet
                                                number 1504
                                                \tabularnewline
  20 & time[2]         & \texttt{0002c3ef}    & 3rd mark after 181231~ms
                                                (00:03:01.231)
                                                \tabularnewline
  24 & Comag info packet[2]
                       & \texttt{000008d4}    & 3rd mark at Comag info packet
                                                number 2260
                                                \tabularnewline
  28 & time[3]         & \texttt{0003abcd}    & 4th mark after 240589~ms
                                                (00:04:00.589)
                                                \tabularnewline
  2c & Comag info packet[3]
                       & \texttt{00000bf1}    & 4th mark at Comag info packet
                                                number 3057
                                                \tabularnewline
  30 & time[4]         & \texttt{0004986a}    & 5th mark after 301162~ms
                                                (00:05:01.162)
                                                \tabularnewline
  34 & Comag info packet[4]
                       & \texttt{00000ee2}    & 5th mark at Comag info packet
                                                number 3810
                                                \tabularnewline
  38 & time[5]         & \texttt{00057ed6}    & 6th mark after 360150~ms
                                                (00:06:00.150)
                                                \tabularnewline
  3c & Comag info packet[5]
                       & \texttt{000011c9}    & 6th mark at Comag info packet
                                                number 4553
                                                \tabularnewline
  40 & time[6]         & \texttt{00066cb4}    & 7th mark after 421044~ms
                                                (00:07:01.044)
                                                \tabularnewline
  44 & Comag info packet[6]
                       & \texttt{0000150e}    & 7th mark at Comag info packet
                                                number 5390
                                                \tabularnewline
  48 & time[7]         & \texttt{0007551c}    & 8th mark after 480540~ms
                                                (00:08:00.540)
                                                \tabularnewline
  4c & Comag info packet[7]
                       & \texttt{000017f9}    & 8th mark at Comag info packet
                                                number 6137
                                                \tabularnewline
  50 & time[8]         & \texttt{00084142}    & 9th mark after 540994~ms
                                                (00:09:00.994)
                                                \tabularnewline
  54 & Comag info packet[8]
                       & \texttt{00001b49}    & 9th mark at Comag info packet
                                                number 6985
                                                \tabularnewline
  58 & time[9]         & \texttt{00092b39}    & 10th mark after 6000889~ms
                                                (00:10:00.889)
                                                \tabularnewline
  5c & Comag info packet[9]
                       & \texttt{00001e95}    & 10th mark at Comag info packet
                                                number 7829
                                                \tabularnewline
  60 & reserved        & \texttt{00}\dots     & \tabularnewline
  79 & \textcolor{unsure}{end mark}        & \textcolor{unsure}{\texttt{89 1f 00 00}} & \textcolor{unsure}{copy of
                                                \texttt{00}--\texttt{03}}
                                                \tabularnewline
  7d & stuffing bytes  & \texttt{00}\dots     & all stuffing bytes are 0
                                                \tabularnewline
  \bottomrule
\end{tabularx}

\paragraph{ToDo:} Examine the contents of this file after marks are set but
before cutting. Examine the contents of this file after cutting. Try to find
out the semantic.

\section{The \texttt{rec.cp} File}
\label{sec:rec.cp-file}

If this file is missing at a record, the receiver recreates an empty
one. Empty files consist of 372 Bytes 0x00. Nothing more about this file is
known, but we think, that the cutting points are saved at this file after
cutting was done.

\paragraph{Example:}
{\small
\begin{alltt}\color{unknown}
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000170  00 00 00 00                                       |....|
\end{alltt}
}

\paragraph{ToDo:} Examine the contents of this file after marks are set but
before cutting. Examine the contents of this file after cutting. Try to find
out the semantic.

\bibliography{data}

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% mode: Tex-pdf
%%% End: 
