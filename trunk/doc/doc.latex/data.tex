%
% data.tex
% Copyright (c) Markus Kohm, 2009
%
% This program is free software; you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation; version 2 of the License.
%
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License
% along with this program; if not, write to the Free Software
% Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
%

\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[english]{babel}
\usepackage{alltt}
\usepackage{xspace}
\usepackage{booktabs,tabularx}
\usepackage{amsmath}
\usepackage{svn}\SVN $Id$
\usepackage{hyperref}
\usepackage[tables]{xcolor}

\hypersetup{%
  pdftitle={Data Formats of the Comag PVR2/100CI or Silvercrest SL80/2 100CI},
  pdfauthor={Markus Kohm},
  pdfkeywords={meta.dat,rec.cp,rec.bm,rec.ts,Comag PVR2/100CI,%
    Silvercrest SL80/2 100CI},
}

\newcommand*{\Comag}{Comag PVR2/100CI\xspace}
\newcommand*{\Silvercrest}{Silvercrest SL80/2 100CI\xspace}

\begin{document}
\pdfbookmark[1]{\Comag}{title}
\title{Data Formats of the \Comag\footnote{aka
    \Silvercrest}\,\footnote{This is: ``\SVNId''.}}
\author{Markus Kohm}
\SVNdate $Date$
\maketitle
\begin{abstract}
  The sat receiver \Comag or \Silvercrest has an internal HDD and may record
  to this an play from it. It can also handle external storage devices via
  USB. Recordings are managed to special named directories with three
  management files \texttt{meta.dat}, \texttt{rec.cp}, \texttt{rec.bm} and
  several MPEG transport stream files, names \texttt{rec.ts}, \texttt{rec.01},
  \texttt{rec.02} \dots\@\ Only special TS files can be used by the receiver.
\end{abstract}

\pdfbookmark[1]{\contentsname}{toc}
\tableofcontents

\section{The HDD-Organization}
\label{sec:hdd-organization}

The \Comag reads only the first VFAT partition of the HDD or storage
device. This partition type should be FAT32~LBA (0xC) and the filesystem has
to be VFAT. Nevertheless the \Comag does not show long filenames but trunks
all filenames to eight characters.

Records should be done to the root directory and are organized in directories
named \texttt{rec\_\textit{DDDD}} where \texttt{\textit{DDDD}} is a four digit
decimal number. We call these directories \emph{Records}. See
\autoref{sec:records} for more information about.

Note: Sometimes external USB storages may not be recognized. Sometimes it
helps to unplug an replug the USB cable.

\section{The \texttt{rec\_\textit{DDDD}} Directories}
\label{sec:records}

A \emph{Record} is a directory named \texttt{rec\_\textit{XXXX}} with
\texttt{\textit{DDDD}} is a four digit decimal number. Only files at
directories with this naming scheme are recognized by the \Comag to be
playable.

Each Record contains three management files and one or more files with the
transport stream. The management files are:
\begin{labeling}[:]{\texttt{meta.dat}}
\item [\texttt{meta.dat}] This information will be shown in the display and
  the overview but not in the info box or while cutting. It is
  essential. Without this information the record does not work. See
  \autoref{sec:meta.dat-file} for more information about.
\item [\texttt{rec.bm}] This information may be regenerated by the \Comag, if
  it is not there. See \autoref{sec:rec.bm-file} for more information about.
\item [\texttt{rec.cp}] This information may be regenerated by the \Comag, if
  it is not there. See \autoref{sec:rec.cp-file} for more information about.
\end{labeling}

The transport stream is saved at files \texttt{rec.ts}, \texttt{rec.01},
\texttt{rec.02} \dots\@\ Each with a maximum file size of 2.0\,GB\footnote{The
  exact maximum file size seems to be $2\,147\,471\,360\,\textrm{Bytes} =
  11\,422\,720 \cdot 188\,\textrm{Bytes}$. And the first file, \texttt{rec.ts}
  seems to be even smaller.}. See \autoref{sec:rec.ts-file} for more
information about.

\section{The \texttt{meta.dat} File}
\label{sec:meta.dat-file}

This file is essential for records. If it is missing the \Comag does not
longer recognize the record. The structure of the file is shown in
\autoref{tab:meta.dat-structure}. Column ``Pos.'' shows the hexadecimal
position of the information from the start of the file starting with
00. Column ``Length'' gives the length of the information. A ``Word'' consists
of two bytes with low byte first. A ``Long'' consists of two Word with low
Word first. \emph{Unknown} Bytes may have different values. \emph{Fixed} Bytes
have always the same value. \emph{Reserved} Bytes are fixed Bytes with value
0x00.

\begin{table}\small
  \centering
  \captionabove{Structure of the \texttt{meta.dat}}
  \begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}r@{~}ll>{\raggedright}X}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & \multicolumn2l{Length} & Semantic & Comment\tabularnewline
    \midrule
    00 & 5  & Bytes & unknown       & seams to be a fixed: \texttt{05 00 72 6a
                                      07}\tabularnewline{}
    05 & 7  & Bytes & reserved      & \tabularnewline{}
    0c & 1  & Byte  & type of title & 8 = transmission, 2 = station or manual
                                      input\tabularnewline{}
    0d & 62 & Byte  & title         & \texttt{NUL} terminated
                                      string\tabularnewline{}
    4b &  1 & Byte  & hour (start time) & GMT is used!\tabularnewline{}
    4c &  1 & Byte  & minute (start time) & \tabularnewline{}
    4d &  1 & Byte  & second (start time) & \tabularnewline{}
    4e &  1 & Word  & reserved            & \tabularnewline{}
    50 &  1 & Word  & year (start time)   & \tabularnewline{}
    52 &  1 & Byte  & month (start time)  & \tabularnewline{}
    53 &  1 & Byte  & day (start time)    & \tabularnewline{}
    54 &  1 & Byte  & weekday (start time) & 0 = Sunday, 1 = Monday
                                             \dots\tabularnewline{}
    55 &  3 & Bytes & reserved      & \tabularnewline{}
    58 &  1 & Long  & info packets  & absolute number of Comag info
                                      packets at all ts files of the
                                      TS\tabularnewline{}
    5c &  1 & Byte  & hours (duration) & \tabularnewline{}
    5d &  1 & Byte  & minutes (duration) & \tabularnewline{}
    5e &  1 & Byte  & seconds (duration) & \tabularnewline{}
    5f &  1 & Byte  & reserved      & \tabularnewline{}
    60 &  1 & Byte  & service       & 0 = TV, 1 = Radio\tabularnewline{}
    61 &  3 & Bytes & reserved      & \tabularnewline{}
    64 &  1 & Byte  & fixed 01      & \emph{semantic unkown}\tabularnewline{}
    65 &  3 & Bytes & reserved      & \tabularnewline{}
    68 &  1 & Word  & PID           & the program ID\tabularnewline{}
    6a &  2 & Bytes & reserved      & \tabularnewline{}
    6c &  1 & Long  & timer number  & All records are done by timers and this
                                      is the number of the timer used for the
                                      record.\tabularnewline
    \bottomrule
  \end{tabularx}
  \label{tab:meta.dat-structure}
\end{table}

\paragraph{Example:}
{\small
\begin{alltt}
00000000  05 00 72 6a 07 00 00 00  00 00 00 00 08 4a 61 6d  |..rj.........Jam|
00000010  65 73 20 42 6f 6e 64 20  30 30 37 20 2d 20 49 6d  |es Bond 007 - Im|
00000020  20 47 65 68 65 69 6d 64  69 65 6e 00 00 00 00 00  | Geheimdien.....|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 13 37 00 00 00  |............7...|
00000050  d8 07 07 08 02 00 00 00  6e 2e 01 00 02 0f 05 00  |........n.......|
00000060  00 00 00 00 01 00 00 00  cf 6d 00 00 00 00 00 00  |.........m......|
00000070
\end{alltt}
}

\noindent\begin{tabularx}{\textwidth}{>{\ttfamily}r@{:\hskip2\tabcolsep}l>{\ttfamily}ll}
    \toprule
    \multicolumn1{r@{\quad}}{Pos.} & Semantic & Value & Explain\tabularnewline
    \midrule
    00 & unknown or fixed & 05 00 72 6a 07 & \tabularnewline{}
    05 & reserved      & 00 00 00 00 00 00 00 & \tabularnewline{}
    0c & type of title & 08 & transmission\tabularnewline{}
    0d & title         & James Bond 007 - Im Geheimdien & \tabularnewline{}
    4b & hour (start time) & 13 & 19 o'clock\tabularnewline{}
    4c & minute (start time) & 37 & 55 minutes\tabularnewline{}
    4d & second (start time) & 00 & 0 seconds\tabularnewline{}
    4e & reserved            & 0000 & \tabularnewline{}
    50 & year (start time)   & 07d8 & 2008\tabularnewline{}
    52 & month (start time)  & 07 & july\tabularnewline{}
    53 & day (start time)    & 08 & 8th\tabularnewline{}
    54 & weekday (start time) & 02 & Tuesday\tabularnewline{}
    55 & reserved      & 00 00 00 & \tabularnewline{}
    58 & info packets  & 00012e6e & 77422\tabularnewline{}
    5c & hours (duration) & 02 & 2 hours\tabularnewline{}
    5d & minutes (duration) & 0f & 15 minutes\tabularnewline{}
    5e & seconds (duration) & 05 & 5 seconds\tabularnewline{}
    5f & reserved      & 00 & \tabularnewline{}
    60 & service       & 00 & TV\tabularnewline{}
    61 & reserved      & 00 00 00\tabularnewline{}
    64 & fixed 01      & 01 & \emph{unkown}\tabularnewline{}
    65 & reserved      & 00 00 00& \tabularnewline{}
    68 & PID           & 6dcf & 28111\tabularnewline{}
    6a & reserved      & 00 00 & \tabularnewline{}
    6c & timer number  & 00000000 & 0\tabularnewline
    \bottomrule
  \end{tabularx}

\paragraph{ToDo:} Some Bytes of the \texttt{meta.dat} are still unknown. We
have to do more experiments to get more information about those.

\section{The \texttt{rec.ts}, \texttt{rec.01}, \texttt{rec.02} \dots Files}
\label{sec:rec.ts-file}

These files are the MPEG transport stream of the record. A normal MPEG
transport stream of the \Comag exists of 5 header packets, video packets of a
single video stream, audio packets of up to two audio streams, private packets
with EPG\footnote{EPG = electronic program guide}, private packets with
VTX\footnote{VTX = video text}, optional private packets with additional AUDIO
streams, e.g., AC3 sound, null packets, PAT\footnote{PAT = program accociation
  table} packets and PMT\footnote{PMT = program map table} packets.

The header, which we call \emph{Comag TS header}, consists of two null
packets, followed by a PMT packet, followed by a PAT packet, followed by one
more PMT packet. Starting with the 513th packet every 512th packet is a null
packet followed by a PAT and a PMT packet. We call this the \emph{Comag TS
  info block}.

The \emph{Comag TS header} and the \emph{Comag TS info block} are essential
for the receiver. If they are missing or broken, the \Comag cannot play the
record an may even hang up.


\subsection{General Information about TS}
\label{sec:ts-general}

MPEG transport streams (TS) consists of single packets of 188 octets. An octet
are 8~bits. For building Bytes from octets you have to but the first sended
bit of the octet into the highest bit of the Byte, the second sendes bit into
the second highest bit of the Byte and so on until the 8th sended bit will
stay in the lowest bit of the Byte. So a data stream of 10101010 (first sendes
bit is the right most) will become the Byte 0x33. We use Bytes in this
documentation!

Many general informations about TS may be found at \cite{iso13818-1},
\cite{iso13818-2}, \cite{iso13818-3}, and \cite{iso13818-4}. The \Comag uses
only some packets. So we describe only them in this document. The general
structure of TS~packets may be found at \autoref{tab:ts-general}.

\begin{table}\small
  \centering
  \captionabove{General structure of a transport stream packet}
  \begin{tabularx}{\textwidth}{>{\ttfamily}ll>{\raggedright}X}
    \toprule
    \multicolumn1l{Name} & No. of bits & Comment \tabularnewline
    \midrule
    sync\_byte                    &  8 & must be 0100\,0111 (0x47) 
                                        \tabularnewline
    transport\_error\_indicator  &  1 & set if there is an error at the packet
                                        \tabularnewline
    payload\_unit\_start\_indicator &  1 & set if payload starts with the first
                                        bytes of a PES or a PSI packet
                                        \tabularnewline
    transport\_priority          &  1 & set if the packet has priority above
                                        other packets\tabularnewline
    PID                          & 13 & type of data see \autoref{tab:PID}
                                        \tabularnewline
    transport\_scrambling\_control &  2 & scrambling mode for the
                                        \texttt{data\_byte[]} only; 
                                        Null packets should never be
                                        scrambled; 00 = not scrambled
                                        \tabularnewline
    adaptation\_field\_control   &  2 & 00 = reserved\\
                                        01 = no adaptation field, payload at
                                        \texttt{data\_byte[]}\\
                                        10 = adaptation field, no payload\\
                                        11 = adaptation field, payload at
                                        \texttt{data\_byte[]}
                                        \tabularnewline
    continuity\_counter          &  4 & used to recognize duplicate packets
                                        \tabularnewline
    adaptation\_field            &$8N$& for size see description of adaptation
                                        field
                                        \tabularnewline
    data\_byte[]                 &$8S$& PES, PSI, stuffing, private data;
                                        $S = 184 - N$
                                        \tabularnewline
    \bottomrule
  \end{tabularx}
  \label{tab:ts-general}
\end{table}

\paragraph{Additional information to some elements of the TS~packet:}
\setkomafont{descriptionlabel}{\ttfamily}
\begin{description}
\item[sync\_byte] -- In theory the TS does not need to start with a packet and
  one packet does not need to follow a packet. Packets may be recognized by a
  \emph{sync\_byte} Byte. But it seams that at the records of the \Comag the
  files consists only of packets and no \emph{garbage} may be found before the
  first packet or between packets.
\item[payload\_unit\_start\_indicator] -- PES or PSI packets may be longer
  than 184~bytes minus the length of an optional adaptation field. At the
  first TS packet of a PES or PSI packet this bit should be 1. If no PES or
  PSI packet starts at the TS packet the bit should be 0.

  For null packets the \texttt{payload\_unit\_start\_indicator} should also be
  0.

  For private data not of \texttt{stream\_type} 5 or 6 the meaning is not
  defined.
\item[transport\_priority] -- Depending on the decoder this bit may be related
  to the PID of the packet or not.
\item[PID] -- An general overview of the PIDs may be found in
  \autoref{tab:PID}. Important for the \Comag are null packets with PID
  0x1fff, that may be Comag info packets, program association table (PAT) with
  PID 0x0000, and audio, videom and program map table (PMT) with PID
  0x0010\dots 0x1ffe.
\item[transport\_scrambling\_control] -- This document does not handle
  scambled data, so this should be 00 at least for private packets, PAT, and
  PMT.
\item[adaptation\_field\_control] -- We split this into \texttt{AF} and
  \texttt{PD}. The first (topmost) bit is \texttt{AF}. If \texttt{AF} was set,
  the \texttt{adaptation\_field} is used and $N$ ist not 0. The second (lower)
  bit is \texttt{PD}. If \texttt{PD} was set, the \texttt{data\_byte[]} array
  has payload data and not only suffing bytes.
\item[continuity\_counter] -- This value is PID dependent. Is increases for
  every packets with the same PID. If two consecutive TS packets have the same
  PID and the same \texttt{continuity\_counter} they are
  duplicates. Duplicates may be send for synchronization purpose.
\item[adaptation\_field] -- The adaptation field may have several data. Most
  interesting are PCR and DTS, that are clock informations. Detailed
  information about the adaptation field may be found at
  \autoref{sec:adaptation-field}.
\item[{data\_byte[]}] -- This array may contain either of stuffing bytes 0xff or
  of payload. Payload is the data of private packets, null packets, PES, PSI.
\end{description}


\subsection{Adaptation Field at Transport Stream Packets}
\label{sec:adaptation-field}

The adaptation field may have several data. Most interesting are PCR and DTS,
that are clock informations. The adaptation field may also used for stuffing
at packets with PES packets. The general structure of adaptation fields may be
found at \autoref{tab:adaptation-field}. The adaptation field is only part of
the TS~packet if the \texttt{AF} is 1.

\begin{table}\small
  \begin{addmargin}[-4em]{-4em}
    \addtolength{\textwidth}{8em}
  \captionabove{General structure of the adaptation field}
  \begin{tabularx}{\textwidth}{>{\ttfamily}lr>{\raggedright}X}
    \toprule
    \multicolumn1l{Name} & \hspace{-2em}No. of bits & Comment \tabularnewline
    \midrule
    adaptation\_field\_length      &  8 & \tabularnewline
    discontinuity\_indicator       &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    random\_access\_indicator      &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    elementary\_stream\_priority\_indicator 
                                   &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    PCR\_flag                      &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    OPCR\_flag                     &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    splicing\_point\_flag          &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    transport\_private\_data\_flag &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    adaptation\_field\_extension\_flag 
                                   &  1 & only if 
                                          $\texttt{adaptation\_field\_length} >
                                          0$
                                          \tabularnewline
    program\_clock\_reference\_base
                                   & 33 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    reserved                       &  6 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    program\_clock\_reference\_extension 
                                   &  9 & only if $\texttt{PCR\_flag} = 1$
                                          \tabularnewline
    original\_program\_clock\_reference\_base
                                   & 33 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    reserved                       &  6 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    original\_program\_clock\_reference\_extension 
                                   &  9 & only if $\texttt{OPCR\_flag} = 1$
                                          \tabularnewline
    splice\_countdown              &  8 & only if 
                                          $\texttt{splicing\_point\_flag} = 1$
                                          \tabularnewline
    transport\_private\_data\_length
                                   &  8 & only if 
                                          $\mathtt{transport\_private\_data\_flag}
                                          = 1$
                                          \tabularnewline
    transport\_private\_data\_byte[] 
                                   &$8P$& $P =
                                          \mathtt{transport\_private\_data\_length}$
                                          \tabularnewline
    adaptation\_field\_extension\_length
                                   &  8 & only if
                                          $\mathtt{adaptation\_field\_extension\_flag}
                                          = 1$
                                          \tabularnewline
    ltw\_flag                      &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    piecewise\_rate\_flag          &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    seamless\_splice\_flag         &  1 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    reserved                       &  5 & only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 0$
                                          \tabularnewline
    ltw\_valid\_flag               &  1 & only if
                                          $\mathtt{ltw\_flag} = 1$
                                          \tabularnewline
    ltw\_offset                    & 15 & only if
                                          $\mathtt{ltw\_flag} = 1$
                                          \tabularnewline
    reserved                       &  2 & only if
                                          $\mathtt{piecewise\_rate\_flag} = 1$
                                          \tabularnewline
    piecewise\_rate                & 22 & only if
                                          $\mathtt{piecewise\_rate\_flag} = 1$
                                          \tabularnewline
    splice\_type                   &  4 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[32..30]          &  3 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[29..15]          & 15 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    DTS\_next\_AU[14..0]           & 15 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    marker\_bit                    &  1 & only if
                                          $\mathtt{seamless\_splice\_flag} =
                                          1$
                                          \tabularnewline
    reserved[]                     &$8R$& only if
                                          $\mathtt{adaptation\_field\_extension\_length}
                                          > 1$
                                          \tabularnewline
    stuffing\_data[]               &$8D$& only if
                                          $\mathtt{adaptation\_field\_length}
                                          > 1$
                                          \tabularnewline
   \bottomrule
  \end{tabularx}
  \label{tab:adaptation-field}
  \end{addmargin}
\end{table}

\paragraph{Additional information to some elements of the adaptation field:}
\setkomafont{descriptionlabel}{\ttfamily}
\begin{description}
\item[adaptation\_field\_length] -- If this is 0x00 no more data follows in
  the adaptation field and the \texttt{adaptation\_field\_length} is a kind of
  single stuffing byte.
\item[discontinuitiy\_indicator] -- If this is not present it is 0. If it is
  1, it indicates a discontinuity either of system time-base or
  \texttt{continuity\_counter}.

  See \cite[section~2.4.3.5]{iso-13818-1} for information about system
  time-base discontinuity.

  See \cite[section~2.4.3.5]{iso-13818-1} for information about
  \texttt{continuity\_counter} discontinuity.
\item[random\_acess\_indicator] -- See \cite[section~2.4.3.5]{iso-13818-1} for
  information about this.
\item[elementary\_stream\_priority\_indicator] -- See
  \cite[section~2.4.3.5]{iso-13818-1} for information about this.
\item[PCR\_flag] -- 1 indicates a PCR field at the adaptation field.
\item[OPCR\_flag] -- 1 indicates a OPCR field at the adaptation field.
\item[splicing\_point\_flag] -- 1 indicates a \texttt{splice\_countdown} field
  in the adaptation field.
\item[transport\_private\_data\_flag] -- 1 indicates one or more
  \texttt{transport\_private\_data\_byte} in the adaptation field.
\item[adaptation\_field\_extension\_flag] -- 1 indicates adaptation field
  extensions at the adaptation field.
\item[program\_clock\_reference\_base; program\_clock\_referenc\_extension]
  The program clock reference (PCR) is a 42~bit~value giving the program clock
  in 27~MHz. It is calculated:
  \begin{align}
  \mathrm{PCR} &= 300 \cdot \mathtt{program\_clock\_reference\_base} \notag\\
               &+ \mathtt{program\_clock\_reference\_extension}\,.
  \end{align}
\item[original\_program\_clock\_reference\_base] -- See
  \texttt{program\_clock\_reference\_base}.
\item[original\_program\_clock\_referenc\_extension] -- See \texttt{program\_clock\_referenc\_extension}.
\item[splice\_countdown] -- See
  \cite[section~2.4.3.5]{iso-13818-1} for information about this.
\item[transport\_private\_data\_length] -- The length of the data at the
  immediate following \texttt{transport\_private\_data\_byte[]}. The data
  itself should not extends beyound the adaptation field. So the
  \texttt{transport\_private\_data\_length} should be at least less than 181
  and even lesser if PCR, OPCR or \texttt{splice\_dountdown} are used.
\item[{transport\_private\_data\_byte[]}] -- The data of this field is no
  specified by IEC.
\item[adaptation\_field\_extension\_length] -- The length of the 
  immediate following data including reserved bytes if pressent.
\item[ltw\_flag] -- 1 indicates \texttt{ltw\_valid} and \texttt{ltw\_offset} at
  the extension.
\item[piecewise\_rate\_flag] -- 1 indicates \texttt{piecewise\_rate} at the
  extension.
\item[seamless\_splice\_flag] -- 1 indicate \texttt{splice\_type},
  \texttt{DTS\_next\_AU} and the \texttt{marker\_bit}s at the extension. Note,
  that it should be 1 only if the \texttt{splicing\_point\_flag} is 1 too.
\item[ltw\_valid\_flag] -- 1 indicates, that the value of \texttt{ltw\_offset}
  is valid. 0 indicates, that the value of \texttt{ltw\_offset} is undefined.
\item[ltw\_offset] -- See
  \cite[section~2.4.3.5]{iso-13818-1} for information about this.
\item[piecewise\_rate] -- The value of this is only valid if both
  \texttt{ltw\_flag} and \texttt{ltw\_valid\_flag} are set to 1. See
  \cite[section~2.4.3.5]{iso-13818-1} for information about this.
\item[splice\_type] -- See
  \cite[section~2.4.3.5]{iso-13818-1} for information about this.
\item[DTS\_next\_AU]  -- 33 bit value of the DTS. 
\item[{stuffing\_data[]}] -- All these bytes are 1111\,1111 (0xff). They are
  used to stuff the TS packet to 188 bytes.
\end{description}


\subsection{Comag TS Header}
\label{sec:comag-ts-header}

The header consists of 5 packets: null packet, null packet, PMT packet, PAT
packet, PMT packet. The second PMT packet is a copy if the first one. The
second null packet consists of payload with stuffing bytes\footnote{Stuffing
  bytes are 0xff.} only. The first null packet is called \emph{Comag info
  packet}.

\paragraph{Structure:}

\textsc{To be continued}

\paragraph{Example:}

\paragraph{ToDo:} Some Bytes of the Comag TS header are still unknown. We
have to do more experiments to get more information about those.

\section{The \texttt{rec.bm} File}
\label{sec:rec.bm-file}

If this file is missing at a record, the receiver recreates an empty
one. Empty files consist of four Bytes 0xff, followed by one Byte 0x01,
followed by 411 Bytes 0x00. Nothing more about this file is known, but we
think, that the marks are saved at this file.

\paragraph{Example:}
{\small
\begin{alltt}
00000000  ff ff ff ff 01 00 00 00  00 00 00 00 00 00 00 00  |................|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000170  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000180  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000190  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
\end{alltt}
}

\paragraph{ToDo:} Examine the contents of this file after marks are set but
before cutting. Examine the contents of this file after cutting. Try to find
out the semantic.

\section{The \texttt{rec.cp} File}
\label{sec:rec.cp-file}

If this file is missing at a record, the receiver recreates an empty
one. Empty files consist of 372 Bytes 0x00. Nothing more about this file is
known, but we think, that the cutting points are saved at this file after
cutting was done.

\paragraph{Example:}
{\small
\begin{alltt}
00000000  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000040  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000060  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000070  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000080  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000090  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000a0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000c0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000e0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000d0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000000f0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000100  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000150  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000160  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000170  00 00 00 00                                       |....|
\end{alltt}
}

\paragraph{ToDo:} Examine the contents of this file after marks are set but
before cutting. Examine the contents of this file after cutting. Try to find
out the semantic.

\end{document}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: t
%%% mode: Tex-pdf
%%% mode: reftex
%%% reftex-plug-into-AUCTeX: t
%%% End: 
